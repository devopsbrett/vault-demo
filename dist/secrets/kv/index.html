<!DOCTYPE html><html data-n-head="" data-n-head-ssr><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="Nuxt.js + Vuetify.js project" name="description" data-hid="description"><title data-n-head="true">training</title><link href="/favicon.ico" rel="icon" data-n-head="true" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons" rel="stylesheet" data-n-head="true"><link href="/_nuxt/manifest.5c87e2747ca2a939c649.js" rel="preload" as="script"><link href="/_nuxt/common.f9af2743d225ed978f0a.js" rel="preload" as="script"><link href="/_nuxt/app.7b0b4d65d5627a7c9315.js" rel="preload" as="script"><link href="/_nuxt/common.883da5e1f051a01c146648e5a4b9ee52.css" rel="preload" as="style"><link href="/_nuxt/layouts/default.5645925a3434e2e552b8.js" rel="preload" as="script"><link href="/_nuxt/pages/secrets/kv.16b3509a2259111d9f50.js" rel="preload" as="script"><link href="/_nuxt/pages/setup/pki.7cf6365125b6e2e7ff3b.js" rel="prefetch"><link href="/_nuxt/pages/secrets/pki.39808cafed0511935c27.js" rel="prefetch"><link href="/_nuxt/pages/secrets/consul.10ed9a95c6b6c2401411.js" rel="prefetch"><link href="/_nuxt/pages/setup/token.247946875d2e94bf8de9.js" rel="prefetch"><link href="/_nuxt/pages/setup/certificate.06d8406933d35d8eba33.js" rel="prefetch"><link href="/_nuxt/pages/setup/config.95ed70a5b6e340ee0386.js" rel="prefetch"><link href="/_nuxt/pages/index.30e6e94711883531f997.js" rel="prefetch"><link href="/_nuxt/pages/inspire.e003c8574907f0fe802a.js" rel="prefetch"><link href="/_nuxt/pages/initial_unseal.47087fd92fab6a1894c0.js" rel="prefetch"><link href="/_nuxt/pages/auth/token.02558f2b18d1c945dfcf.js" rel="prefetch"><link href="/_nuxt/pages/audit/syslog.6f3b5adef74744a64560.js" rel="prefetch"><link href="/_nuxt/pages/setup/unseal.c596fc5825280c9f941b.js" rel="prefetch"><link href="/_nuxt/common.883da5e1f051a01c146648e5a4b9ee52.css" rel="stylesheet"><style data-vue-ssr-id="5d3695ef:0 5b2ac48e:0 6736c5d5:0">.lighttext,.lighttext button{color:#fff!important}div.card{margin-bottom:10px}.term{background:#424242;display:inline-block;white-space:pre;margin-bottom:5px}.term,ul.vagrantterm{padding:5px;width:100%;color:#fff;border-radius:3px;font-size:85%;font-weight:900;font-family:monospace,monospace;overflow-x:scroll}ul.vagrantterm{background-color:#424242;list-style-type:none;margin-bottom:10px}ul.vagrantterm li.command{white-space:pre}ul.vagrantterm li.command:before{content:"[vagrant@localhost ~]$ "}ul.vagrantterm li.command:after{content:"\A0"}ul.vagrantterm li.file-contents{white-space:pre-line;-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}ul.vagrantterm li.response{white-space:pre-line}ul.vagrantterm li.formatted-response,ul.vagrantterm li.response{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}ul.vagrantterm li.formatted-response{white-space:pre}ul.vagrantterm li.formatted-response:after{content:"\A0"}ul.vagrantterm li.comment{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;color:hsla(0,0%,75%,.7)}ul.vagrantterm li.comment:before{content:"// "}div.headline{text-transform:capitalize}p[data-v-464581d9]{text-align:justify}code[data-v-464581d9]{text-align:left;white-space:pre;overflow-x:scroll}</style><body data-n-head=""><div id="__nuxt" data-server-rendered="true"><div class="nuxt-progress" style="width:0%;height:5px;background-color:#ffc107;opacity:0"></div><div class="application application--light" data-app="true" id="app"><aside class="navigation-drawer navigation-drawer--open navigation-drawer--persistent theme--dark" data-v-2535cd02 style="height:100%;margin-top:0;max-height:calc(100% - undefinedpx);width:300px"><ul class="list list--dense" data-uid="341" data-v-2535cd02><div class="list--group__container" data-v-2535cd02><div class="list--group__header"><li data-v-2535cd02><div class="list__tile"><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>settings_applications</i></div><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Initial Setup</div></div><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>keyboard_arrow_down</i></div></div></div><ul class="list list--group" style="display:none"><li data-v-2535cd02><a href="/setup/unseal" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Unseal & Initialise</div></div></a><li data-v-2535cd02><a href="/setup/pki" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Setup PKI Backend</div></div></a><li data-v-2535cd02><a href="/setup/certificate" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Generate Cert for Vault</div></div></a><li data-v-2535cd02><a href="/setup/config" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Modify Config</div></div></a><li data-v-2535cd02><a href="/setup/token" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Create Token to Manage Renewals</div></div></a></ul></div><div class="list--group__container" data-v-2535cd02><div class="list--group__header"><li data-v-2535cd02><div class="list__tile"><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>info</i></div><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Audit Backends</div></div><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>keyboard_arrow_down</i></div></div></div><ul class="list list--group" style="display:none"><li data-v-2535cd02><a href="/audit/syslog" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Sending Audit Logs to Syslog</div></div></a></ul></div><div class="list--group__container" data-v-2535cd02><div class="list--group__header"><li data-v-2535cd02><div class="list__tile"><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>enhanced_encryption</i></div><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Secret Storage/Generation</div></div><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>keyboard_arrow_down</i></div></div></div><ul class="list list--group" style="display:none"><li data-v-2535cd02><a href="/secrets/kv" class="nuxt-link-exact-active list__tile--active list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>The KV Backend</div></div></a><li data-v-2535cd02><a href="/secrets/consul" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Generating Consul Credentials</div></div></a><li data-v-2535cd02><a href="/secrets/pki" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>SSL Certificates with PKI Backend</div></div></a></ul></div><div class="list--group__container" data-v-2535cd02><div class="list--group__header"><li data-v-2535cd02><div class="list__tile"><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>person</i></div><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Users/Authentication Management</div></div><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>keyboard_arrow_down</i></div></div></div><ul class="list list--group" style="display:none"><li data-v-2535cd02><a href="/auth/token" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Create new token</div></div></a></ul></div></ul><div class="navigation-drawer__border"></div></aside><nav class="blue lighttext toolbar toolbar--fixed" style="margin-top:0;padding-left:300px;padding-right:0"><div class="toolbar__content" style="height:56px"><button class="toolbar__side-icon btn btn--icon btn--raised" type="button"><div class="btn__content"><i class="material-icons icon">menu</i></div></button><div class="toolbar__title">Vault training</div><div class="spacer"></div></div></nav><main><div class="content" style="padding-top:56px;padding-right:0;padding-bottom:undefinedpx;padding-left:300px"><div class="container"><div class="layout column justify-center align-center" data-v-464581d9 data-v-464581d9><div class="flex xs12 sm10 md8" data-v-464581d9 data-v-464581d9><div class="card" style="height:auto" data-v-464581d9><div class="card__title headline" data-v-464581d9>The Key/Value Backend</div><div class="card__text" data-v-464581d9><p data-v-464581d9>In order to generate certificates we first need to create a mount with type pki. This can be done by issuing <code class="elevation-3" data-v-464581d9>vault mount pki</code>. The default path for this mount is <code class="elevation-3" data-v-464581d9>pki/</code>. To mount the pki backend at a different path you can add <code class="elevation-3" data-v-464581d9>-path [path]</code>. For this tutorial we assume the path has been set to <code class="elevation-3" data-v-464581d9>vaultcerts</code>. Once we have a pki mount we should set the <code class="elevation-3" data-v-464581d9>max-lease-ttl</code> to be much higher than the default which is 30 days. While we may not be intending to issue any certificates that last longer than 30 days we probably want our root ca to last much longer as an expired root ca would automatically invalidate all the certificates it had generated. <code class="elevation-3" data-v-464581d9>vault mount-tune -max-lease-ttl=87600h vaultcerts</code> will set the max ttl to be 10 years. Now we can generate a root ca certificate by issuing <code class="elevation-3" data-v-464581d9>vault write vaultcerts/root/generate/internal common_name=vault_ca ttl=87600h</code>. We should make a note of the certificate returned. As this will need to be added to the trusted ca list later. We should also set some configuration values for this root ca namely the urls where clients can find the root ca and the crl. This can be done by writing to the <code class="elevation-3" data-v-464581d9>vaultcerts/config/urls</code> path.</div></div><ul class="vagrantterm" data-v-464581d9><li class="command" data-v-464581d9>vault mount -path=vaultcerts pki<li class="response" data-v-464581d9>Successfully mounted 'pki' at 'vaultcerts'!<li class="command" data-v-464581d9>vault mount-tune -max-lease-ttl=87600h vaultcerts<li class="response" data-v-464581d9>Successfully tuned mount 'vaultcerts'!<li class="command" data-v-464581d9>vault write -field=certificate vaultcerts/root/generate/internal common_name=vault_ca ttl=87600h > rootca.crt<li class="command" data-v-464581d9>vault write vaultcerts/config/urls issuing_certificates="https://127.0.0.1:8200/v1/vaultcerts/ca" crl_distribution_points="https://127.0.0.1:8200/v1/vaultcerts/crl"</ul><div class="card" style="height:auto" data-v-464581d9><div class="card__text" data-v-464581d9><p data-v-464581d9>Now that we have a root ca we should add this to our systems trust store to make sure any of the certificates generated from this mount are trusted. The procedure for doing this changes from distro to distro. We will only be showing the process for CentOS 7.4 as this the distro used on the VM for this tutorial.</div></div><ul class="vagrantterm" data-v-464581d9><li class="command" data-v-464581d9>sudo cp rootca.crt /etc/pki/ca-trust/source/anchors/<li class="command" data-v-464581d9>sudo update-ca-trust</ul><div class="card" style="height:auto" data-v-464581d9><div class="card__actions" data-v-464581d9><a href="/audit/syslog" class="btn btn--flat btn--raised btn--router error--text" data-v-464581d9><div class="btn__content">Audit Backends</div></a><div class="spacer" data-v-464581d9></div><a href="/secrets/consul" class="btn btn--flat btn--raised btn--router primary--text" data-v-464581d9><div class="btn__content">Next</div></a></div></div></div></div></div></div></main><footer class="footer blue footer--fixed" style="padding-left:0;padding-right:0"><span>© 2017</span></footer></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{}],error:null,state:{sidebar:!0},serverRendered:!0}</script><script defer src="/_nuxt/manifest.5c87e2747ca2a939c649.js"></script><script defer src="/_nuxt/layouts/default.5645925a3434e2e552b8.js"></script><script defer src="/_nuxt/pages/secrets/kv.16b3509a2259111d9f50.js"></script><script defer src="/_nuxt/common.f9af2743d225ed978f0a.js"></script><script defer src="/_nuxt/app.7b0b4d65d5627a7c9315.js"></script>