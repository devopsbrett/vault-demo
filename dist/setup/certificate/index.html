<!DOCTYPE html><html data-n-head="" data-n-head-ssr><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="Nuxt.js + Vuetify.js project" name="description" data-hid="description"><title data-n-head="true">training</title><link href="/favicon.ico" rel="icon" data-n-head="true" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons" rel="stylesheet" data-n-head="true"><link href="/_nuxt/manifest.5c87e2747ca2a939c649.js" rel="preload" as="script"><link href="/_nuxt/common.f9af2743d225ed978f0a.js" rel="preload" as="script"><link href="/_nuxt/app.7b0b4d65d5627a7c9315.js" rel="preload" as="script"><link href="/_nuxt/common.883da5e1f051a01c146648e5a4b9ee52.css" rel="preload" as="style"><link href="/_nuxt/layouts/default.5645925a3434e2e552b8.js" rel="preload" as="script"><link href="/_nuxt/pages/setup/certificate.06d8406933d35d8eba33.js" rel="preload" as="script"><link href="/_nuxt/pages/setup/pki.7cf6365125b6e2e7ff3b.js" rel="prefetch"><link href="/_nuxt/pages/secrets/pki.39808cafed0511935c27.js" rel="prefetch"><link href="/_nuxt/pages/secrets/kv.16b3509a2259111d9f50.js" rel="prefetch"><link href="/_nuxt/pages/secrets/consul.10ed9a95c6b6c2401411.js" rel="prefetch"><link href="/_nuxt/pages/setup/token.247946875d2e94bf8de9.js" rel="prefetch"><link href="/_nuxt/pages/setup/config.95ed70a5b6e340ee0386.js" rel="prefetch"><link href="/_nuxt/pages/index.30e6e94711883531f997.js" rel="prefetch"><link href="/_nuxt/pages/inspire.e003c8574907f0fe802a.js" rel="prefetch"><link href="/_nuxt/pages/initial_unseal.47087fd92fab6a1894c0.js" rel="prefetch"><link href="/_nuxt/pages/auth/token.02558f2b18d1c945dfcf.js" rel="prefetch"><link href="/_nuxt/pages/audit/syslog.6f3b5adef74744a64560.js" rel="prefetch"><link href="/_nuxt/pages/setup/unseal.c596fc5825280c9f941b.js" rel="prefetch"><link href="/_nuxt/common.883da5e1f051a01c146648e5a4b9ee52.css" rel="stylesheet"><style data-vue-ssr-id="5d3695ef:0 5b2ac48e:0 a8191e26:0">.lighttext,.lighttext button{color:#fff!important}div.card{margin-bottom:10px}.term{background:#424242;display:inline-block;white-space:pre;margin-bottom:5px}.term,ul.vagrantterm{padding:5px;width:100%;color:#fff;border-radius:3px;font-size:85%;font-weight:900;font-family:monospace,monospace;overflow-x:scroll}ul.vagrantterm{background-color:#424242;list-style-type:none;margin-bottom:10px}ul.vagrantterm li.command{white-space:pre}ul.vagrantterm li.command:before{content:"[vagrant@localhost ~]$ "}ul.vagrantterm li.command:after{content:"\A0"}ul.vagrantterm li.file-contents{white-space:pre-line;-webkit-user-select:all;-moz-user-select:all;-ms-user-select:all;user-select:all}ul.vagrantterm li.response{white-space:pre-line}ul.vagrantterm li.formatted-response,ul.vagrantterm li.response{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}ul.vagrantterm li.formatted-response{white-space:pre}ul.vagrantterm li.formatted-response:after{content:"\A0"}ul.vagrantterm li.comment{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;color:hsla(0,0%,75%,.7)}ul.vagrantterm li.comment:before{content:"// "}div.headline{text-transform:capitalize}</style><body data-n-head=""><div id="__nuxt" data-server-rendered="true"><div class="nuxt-progress" style="width:0%;height:5px;background-color:#ffc107;opacity:0"></div><div class="application application--light" data-app="true" id="app"><aside class="navigation-drawer navigation-drawer--open navigation-drawer--persistent theme--dark" data-v-2535cd02 style="height:100%;margin-top:0;max-height:calc(100% - undefinedpx);width:300px"><ul class="list list--dense" data-uid="289" data-v-2535cd02><div class="list--group__container" data-v-2535cd02><div class="list--group__header"><li data-v-2535cd02><div class="list__tile"><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>settings_applications</i></div><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Initial Setup</div></div><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>keyboard_arrow_down</i></div></div></div><ul class="list list--group" style="display:none"><li data-v-2535cd02><a href="/setup/unseal" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Unseal & Initialise</div></div></a><li data-v-2535cd02><a href="/setup/pki" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Setup PKI Backend</div></div></a><li data-v-2535cd02><a href="/setup/certificate" class="nuxt-link-exact-active list__tile--active list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Generate Cert for Vault</div></div></a><li data-v-2535cd02><a href="/setup/config" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Modify Config</div></div></a><li data-v-2535cd02><a href="/setup/token" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Create Token to Manage Renewals</div></div></a></ul></div><div class="list--group__container" data-v-2535cd02><div class="list--group__header"><li data-v-2535cd02><div class="list__tile"><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>info</i></div><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Audit Backends</div></div><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>keyboard_arrow_down</i></div></div></div><ul class="list list--group" style="display:none"><li data-v-2535cd02><a href="/audit/syslog" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Sending Audit Logs to Syslog</div></div></a></ul></div><div class="list--group__container" data-v-2535cd02><div class="list--group__header"><li data-v-2535cd02><div class="list__tile"><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>enhanced_encryption</i></div><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Secret Storage/Generation</div></div><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>keyboard_arrow_down</i></div></div></div><ul class="list list--group" style="display:none"><li data-v-2535cd02><a href="/secrets/kv" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>The KV Backend</div></div></a><li data-v-2535cd02><a href="/secrets/consul" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Generating Consul Credentials</div></div></a><li data-v-2535cd02><a href="/secrets/pki" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>SSL Certificates with PKI Backend</div></div></a></ul></div><div class="list--group__container" data-v-2535cd02><div class="list--group__header"><li data-v-2535cd02><div class="list__tile"><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>person</i></div><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Users/Authentication Management</div></div><div class="list__tile__action" data-v-2535cd02><i class="material-icons icon" data-v-2535cd02>keyboard_arrow_down</i></div></div></div><ul class="list list--group" style="display:none"><li data-v-2535cd02><a href="/auth/token" class="list__tile list__tile--link"><div class="list__tile__content" data-v-2535cd02><div class="list__tile__title" data-v-2535cd02>Create new token</div></div></a></ul></div></ul><div class="navigation-drawer__border"></div></aside><nav class="blue lighttext toolbar toolbar--fixed" style="margin-top:0;padding-left:300px;padding-right:0"><div class="toolbar__content" style="height:56px"><button class="toolbar__side-icon btn btn--icon btn--raised" type="button"><div class="btn__content"><i class="material-icons icon">menu</i></div></button><div class="toolbar__title">Vault training</div><div class="spacer"></div></div></nav><main><div class="content" style="padding-top:56px;padding-right:0;padding-bottom:undefinedpx;padding-left:300px"><div class="container"><div class="layout column justify-center align-center" data-v-5451935a data-v-5451935a><div class="flex xs12 sm10 md8" data-v-5451935a data-v-5451935a><div class="card" style="height:auto" data-v-5451935a><div class="card__title headline" data-v-5451935a>Generate a certificate for use by vault</div><div class="card__text" data-v-5451935a><p data-v-5451935a>Before we're able to have vault issue certificates for us we must first define a role. A role is a logical name that maps to a policy used to generate those credentials. A role defines some default values and rules regarding the issuing/signing of certificates. Any time you need to generate or sign a certificate in vault you need to specify a role. Later, when we look at authentication and policies you will be able to see how we can restrict these roles to certain users. You can see the parameters available when creating a role by running the command <code class="elevation-3" data-v-5451935a>vault path-help vaultcerts/roles/role</code>. As this role will only be used to generate certificates for vault (Allowing the vault server to run over https rather than http) we are only going to set values which limit the creation of certificates for localhost.</div></div><ul class="vagrantterm" data-v-5451935a><li class="command" data-v-5451935a>vault write vaultcerts/roles/demo allow_ip_sans=true allow_localhost=true client_flag=false code_signing_flag=false email_protection_flag=false max_ttl=8760h<li class="response" data-v-5451935a>Success! Data written to: vaultcerts/roles/demo</ul><div class="card" style="height:auto" data-v-5451935a><div class="card__text" data-v-5451935a><p data-v-5451935a>Now that a role has been created, we can use this to create a certificate/private key pair. To avoid having to copy/paste the certificate/key from the output of the command we're going to tell vault to format the output as JSON and save it to a file in our current directory. We can then use a tool such as <code class="elevation-3" data-v-5451935a>jq</code> to extract the needed values from the JSON and save them to an appropriate location. jq is already installed on the training VM so the commands should work as is.</div></div><ul class="vagrantterm" data-v-5451935a><li class="command" data-v-5451935a>vault write -format=json vaultcerts/issue/demo common_name=localhost ip_sans=127.0.0.1 > localhost-certs.json<li class="command" data-v-5451935a>cat localhost-certs.json | jq -r '.data.certificate' | sudo tee /etc/ssl/vault.crt<li class="response" data-v-5451935a>-----BEGIN CERTIFICATE----- ... -----END CERTIFICATE-----<li class="command" data-v-5451935a>cat localhost-certs.json | jq -r '.data.private_key' | sudo tee /etc/ssl/vault.key<li class="response" data-v-5451935a>-----BEGIN RSA PRIVATE KEY----- ... -----END RSA PRIVATE KEY-----</ul><div class="card" style="height:auto" data-v-5451935a><div class="card__actions" data-v-5451935a><a href="/setup/pki" class="btn btn--flat btn--raised btn--router primary--text" data-v-5451935a><div class="btn__content">Back</div></a><div class="spacer" data-v-5451935a></div><a href="/setup/config" class="btn btn--flat btn--raised btn--router primary--text" data-v-5451935a><div class="btn__content">Next</div></a></div></div></div></div></div></div></main><footer class="footer blue footer--fixed" style="padding-left:0;padding-right:0"><span>Â© 2017</span></footer></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{}],error:null,state:{sidebar:!0},serverRendered:!0}</script><script defer src="/_nuxt/manifest.5c87e2747ca2a939c649.js"></script><script defer src="/_nuxt/layouts/default.5645925a3434e2e552b8.js"></script><script defer src="/_nuxt/pages/setup/certificate.06d8406933d35d8eba33.js"></script><script defer src="/_nuxt/common.f9af2743d225ed978f0a.js"></script><script defer src="/_nuxt/app.7b0b4d65d5627a7c9315.js"></script>